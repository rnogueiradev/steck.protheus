#INCLUDE "PROTHEUS.CH"
#Include "Rwmake.ch"
#Include "TopConn.ch"
#INCLUDE "TBICONN.CH"
#include "TOTVS.CH"

/*====================================================================================\
|Programa  | STTCSQL           | Autor | GIOVANI.ZAGO          | Data | 23/05/2018    |
|=====================================================================================|
|Descrição | UPDATES GERAL								                              |
|          |                                                                          |
|          |                                                                          |
|=====================================================================================|
|Sintaxe   | STTCSQL	                                                              |
|=====================================================================================|
|Uso       | Especifico STECK                                                         |
|=====================================================================================|
|........................................Histórico....................................|
\====================================================================================*/

*-------------------------------*
User Function STTCSQL()
*-------------------------------*
	Local cQry:= ' '

	PREPARE ENVIRONMENT EMPRESA '01' FILIAL '02'


	If dow(date()) = 1  .And. dow(date()) = 7 //domingo ---- sabado
		Return()
	EndIf

	// UPDATE DA SC6 DATA DE ENTREGA1 CUSTOMIZADA  GIOVANI.ZAGO 23/05/2018
	//cQry := " UPDATE SC6010 SET C6_ENTRE1 = C6_ENTRE1 WHERE C6_ENTRE1 = ' '
	//TcSQLExec(cQry)

	// UPDATE DA SC6 DATA DE ENTREGA CORRIGIR PROBLEMA DO MRP  GIOVANI.ZAGO 23/05/2018
	//cQry := " UPDATE SC6010 SET C6_ENTREG = C6_DATFAT WHERE C6_QTDENT > 0  AND C6_ENTREG > '"+ DTOS(DATE())+"'
	//TcSQLExec(cQry)

	//20210317004356
	cQry := " UPDATE SC1010 C1 SET C1_COTACAO=' ' WHERE C1.D_E_L_E_T_=' ' AND C1_FILIAL='02' AND C1_COTACAO='IMPORX' AND C1_NUM_SI=' ' 
	TcSQLExec(cQry)

	cQry := " UPDATE UDBD11.SC1110 C1 SET C1_COTACAO=' ' WHERE C1.D_E_L_E_T_=' ' AND C1_FILIAL='01' AND C1_COTACAO='IMPORX' AND C1_NUM_SI=' ' 
	TcSQLExec(cQry)

	//UPDATE OP NA SH6
	cQry := " MERGE INTO SH6010 H6 USING ( SELECT H6.R_E_C_N_O_ RECSH6, MAX(PP3_CODIGO) AS PP3_CODIGO FROM SH6010 H6 LEFT JOIN PP3010 PP3 ON PP3_FILIAL=H6_FILIAL AND PP3_DTINI = H6_DATAINI AND PP3_HRINI = H6_HORAINI AND PP3_OPER = H6_OPERAC AND PP3_RECURS = H6_RECURSO AND PP3_DTFIM = H6_DATAFIN AND PP3_HRFIM = H6_HORAFIN AND PP3_RECURS = H6_RECURSO AND PP3_MOTIVO = H6_MOTIVO LEFT JOIN SC2010 C2 ON C2_FILIAL=PP3_FILIAL AND PP3_CODIGO=C2_NUM||C2_ITEM||C2_SEQUEN WHERE H6.D_E_L_E_T_=' ' AND PP3.D_E_L_E_T_=' ' AND C2.D_E_L_E_T_=' ' AND H6_FILIAL='05' AND H6_OP=' ' AND H6_TIPO='I' AND C2_QUJE>=C2_QUANT GROUP BY H6.R_E_C_N_O_ ) XXX ON (H6.R_E_C_N_O_=XXX.RECSH6) WHEN MATCHED THEN UPDATE SET H6.H6_OP=XXX.PP3_CODIGO WHERE H6.R_E_C_N_O_=XXX.RECSH6
	TcSQLExec(cQry)

	//cQry := " UPDATE SC6010 SET  C6_OPER = '01' WHERE C6_OPER = ' ' AND C6_FILIAL = '02' AND C6_PEDCLI <> ' '
	//TcSQLExec(cQry)
	
	// UPDATE DO FINANCEIRO GIOVANI ZAGO 23/01/2020
	cQry := " UPDATE SE2010 SET E2_NOMFOR = 'STECK'  WHERE E2_NOMFOR <> 'STECK' AND E2_ORIGEM = 'GPEM670' AND E2_EMISSAO >= '20200101'
	TcSQLExec(cQry)
	
		// UPDATE DO FINANCEIRO GIOVANI ZAGO 23/01/2020
	cQry := " UPDATE SE2030 SET E2_NOMFOR = 'STECK'  WHERE E2_NOMFOR <> 'STECK' AND E2_ORIGEM = 'GPEM670' AND E2_EMISSAO >= '20200101'
	TcSQLExec(cQry)

	cQry := " UPDATE UDBD11.SE2110 SET E2_NOMFOR = 'STECK DISTRIBUIDORA'  WHERE E2_NOMFOR <> 'STECK' AND E2_ORIGEM = 'GPEM670' AND E2_EMISSAO >= '20200101'
	TcSQLExec(cQry)
	
	// UPDATE DO MARKUP ORCAMENTO *RENATO CIENTE  GIOVANI.ZAGO 17/05/2019
	cQry := " UPDATE SUB010 SUB SET UB_ZMARKUP = UB_ZVALLIQ/UB_QUANT/UB_XCUSTO WHERE UB_DTENTRE = '"+ DTOS(DATE())+"' AND UB_ZVALLIQ <> 0 AND UB_XCUSTO <> 0 AND UB_FILIAL = '02'
	TcSQLExec(cQry)

	// UPDATE DA Z1Q NOME DAS PLACAS DE VEICULOS  GIOVANI.ZAGO 02/05/2019
	cQry := "	UPDATE Z1Q010 SET Z1Q_NOME = NVL((SELECT Z1Z_NOME FROM Z1Z010 Z1Z WHERE Z1Z.D_E_L_E_T_ = ' ' AND Z1Z_PLACA = Z1Q_PLACA),' ') WHERE Z1Q_NOME = ' ' AND Z1Q_DATA = '"+ DTOS(DATE())+"'
	TcSQLExec(cQry)
	// UPDATE DA SC6 DATA DE EMISSAO  GIOVANI.ZAGO 23/05/2018
	cQry := "	UPDATE SFT010 SET FT_CFOP = '2352' WHERE FT_CFOP = '1352' AND FT_EMISSAO >= '"+ DTOS(DATE()-1)+"' AND FT_ESTADO <> 'SP' "
	TcSQLExec(cQry)

	// UPDATE DA SC6 DATA DE EMISSAO  GIOVANI.ZAGO 23/05/2018
	cQry := "	UPDATE SC6010 SC6 SET C6_EMISSAO = NVL((SELECT C5_EMISSAO FROM SC5010 SC5 WHERE SC5.D_E_L_E_T_ = ' ' AND C5_NUM = C6_NUM AND C5_FILIAL = C6_FILIAL), ' ') WHERE C6_EMISSAO = ' ' AND C6_FILIAL = '02'
	TcSQLExec(cQry)

	//UPDATE DA SC6 TROCANDO C6_ENTREG POR C6_ENTRE1  GIOVANI.ZAGO 28/09/2018
	cQry := " UPDATE " + RetSqlName("SC6") + " SET C6_ENTREG = C6_EMISSAO WHERE C6_ENTREG <> C6_EMISSAO AND C6_FILIAL = '02' " + CRLF
	TcSQLExec(cQry)

	// Valdemir Rabelo - 14/10/2021 - Ticket: 20201104009927
	cQry := " MERGE INTO " + RetSqlName("SC6") + " C6 " + CRLF
	cQry += "   USING ( " + CRLF
	cQry += "   SELECT C6_FILIAL, C6_NUM, C6_ITEM, C6_PRODUTO, C6_ENTRE1, C6_ENTREG, C5_EMISSAO, C6_EMISSAO, C6.R_E_C_N_O_ RECSC6 " + CRLF
	cQry += "   FROM " + RetSqlName("SC6") + " C6 " + CRLF
	cQry += "   LEFT JOIN " + RetSqlName("SC5") + " C5 " + CRLF
	cQry += "   ON C5_FILIAL=C6_FILIAL AND C5_NUM=C6_NUM     " + CRLF
	cQry += "   WHERE C6.D_E_L_E_T_=' ' AND C5.D_E_L_E_T_=' ' " + CRLF
	cQry += "    AND C6_FILIAL='05' AND C6_ENTRE1<>C6_ENTREG  " + CRLF
	cQry += ") XXX " + CRLF
	cQry += " ON (XXX.RECSC6=C6.R_E_C_N_O_) " + CRLF
	cQry += " WHEN MATCHED THEN UPDATE SET  " + CRLF
	cQry += " C6.C6_ENTREG=XXX.C6_ENTRE1    " + CRLF
	TcSQLExec(cQry)

	// UPDATE DA SD3 GRUPO CORRIGIR PROBLEMA DO REINALDO  GIOVANI.ZAGO 23/05/2018
	cQry := " UPDATE SD3010 TD3 SET TD3.D3_GRUPO = (SELECT B1_GRUPO FROM SB1010 TB1
	cQry += " WHERE TB1.D_E_L_E_T_ = ' ' AND TB1.B1_COD = TD3.D3_COD) WHERE TD3.R_E_C_N_O_ IN (
	cQry += " SELECT SD3.R_E_C_N_O_ FROM SD3010 SD3 INNER JOIN(SELECT * FROM SB1010)SB1 ON SB1.D_E_L_E_T_ = ' ' AND SB1.B1_COD = SD3.D3_COD AND SB1.B1_GRUPO <> SD3.D3_GRUPO AND SB1.B1_GRUPO <> '999'
	cQry += " WHERE SD3.D_E_L_E_T_ = ' ' AND SD3.D3_FILIAL = '04' AND SD3.D3_EMISSAO >= '20190701' AND SD3.D3_GRUPO <> '999')
	TcSQLExec(cQry)

	// UPDATE DA SD3 TIPO CORRIGIR PROBLEMA DO REINALDO  GIOVANI.ZAGO 23/05/2018
	cQry := " UPDATE SD3010 TD3 SET TD3.D3_TIPO = (SELECT B1_TIPO FROM SB1010 TB1
	cQry += " WHERE TB1.D_E_L_E_T_ = ' ' AND TB1.B1_COD = TD3.D3_COD) WHERE TD3.R_E_C_N_O_ IN (
	cQry += " SELECT SD3.R_E_C_N_O_ FROM SD3010 SD3 INNER JOIN(SELECT * FROM SB1010)SB1 ON SB1.D_E_L_E_T_ = ' ' AND SB1.B1_COD = SD3.D3_COD AND SB1.B1_TIPO <> SD3.D3_TIPO WHERE SD3.D_E_L_E_T_ = ' ' AND SD3.D3_FILIAL = '04' AND SD3.D3_EMISSAO >= '20190701' AND SD3.D3_GRUPO <> '999')
	TcSQLExec(cQry)

	// UPDATE DA SA2 FORNECEDOR CORRIGIR PROBLEMA DO JULIANA  GIOVANI.ZAGO 23/05/2018
	cQry := "  UPDATE SA2010 SA2 SET A2_DEDBSPC = '5'  WHERE A2_DEDBSPC <> '5' "
	TcSQLExec(cQry)

	// UPDATE DA SC6 ATUALIZAÇÃO CORRIGIR PROBLEMA DO UPDDISTRI  GIOVANI.ZAGO 23/05/2018
	cQry := "  UPDATE SC6010 SET C6_XOPER = C6_OPER    WHERE C6_OPER <> ' ' AND C6_XOPER = ' '
	TcSQLExec(cQry)

	// UPDATE DA SC6 ATUALIZAÇÃO CORRIGIR PROBLEMA DO UPDDISTRI  GIOVANI.ZAGO 23/05/2018
	cQry := "  UPDATE SC6030 SET C6_XOPER = C6_OPER    WHERE C6_OPER <> ' ' AND C6_XOPER = ' '
	TcSQLExec(cQry)

	// UPDATE DA SC6 ATUALIZAÇÃO CORRIGIR PROBLEMA DO UPDDISTRI  GIOVANI.ZAGO 23/05/2018
	cQry := "  UPDATE UDBD11.SC6110 SET C6_XOPER = C6_OPER    WHERE C6_OPER <> ' ' AND C6_XOPER = ' '
	TcSQLExec(cQry)

	// UPDATE DA SBE ATUALIZAÇÃO CORRIGIR PROBLEMA DO LOCAL  GIOVANI.ZAGO 23/05/2018
	cQry := "  UPDATE SBE010 SET BE_STATUS = '1' WHERE BE_STATUS <> '1' "
	TcSQLExec(cQry)

	//UPDATE PARA CORRIGIR PEDIDOS COM QTDVEN MENOR QUE O QTDENT
	cQry := " UPDATE SC6010 C6
	cQry += " SET C6_QTDENT=C6_QTDVEN
	cQry += " WHERE C6.D_E_L_E_T_=' ' AND C6_QTDVEN-C6_QTDENT < 0
	TcSQLExec(cQry)
	//>> Ticket 20200727004713
	cQry := " UPDATE SC6030 C6
	cQry += " SET C6_QTDENT=C6_QTDVEN
	cQry += " WHERE C6.D_E_L_E_T_=' ' AND C6_QTDVEN-C6_QTDENT < 0
	TcSQLExec(cQry)
	//<<

	//UPDATE PARA ALIMENTAR COMISSOES VENDEDORES STECK ARGENTINA
	cQry := " UPDATE UDBP12ARG.SD2070 SD2 SET D2_COMIS1 =
	cQry += " NVL((SELECT  Z3_COMIS FROM UDBP12ARG.SF2070 SF2
	cQry += " INNER JOIN(SELECT * FROM UDBP12ARG.SZ3070)SZ3
	cQry += " ON SZ3.D_E_L_E_T_ = ' '
	cQry +=	" AND Z3_VENDEDO = F2_VEND1
	cQry += " INNER JOIN(SELECT * FROM UDBP12ARG.SF4070)SF4
	cQry += " ON SF4.D_E_L_E_T_ = ' '
	cQry += " AND F4_DUPLIC = 'S'
	cQry += " WHERE SF2.D_E_L_E_T_ = ' '
	cQry += " AND F2_DOC = SD2.D2_DOC
	cQry +=	" AND F2_DUPL <> ' '
	cQry +=	" AND F2_SERIE = SD2.D2_SERIE
	cQry +=	" AND Z3_GRUPO = SD2.D2_GRUPO
	cQry +=	" AND F2_ESPECIE = 'NF'
	cQry +=	" AND F4_CODIGO = D2_TES
	cQry += " ),0)
	cQry +=	" WHERE SD2.D_E_L_E_T_ = ' '
	cQry +=	" AND D2_SERIE <> 'R' AND D2_EMISSAO >= '"+ DTOS(DATE()-1)+"' 
	TcSQLExec(cQry)
 
	//ajustar bf divergente da dc
	cQry :=	" MERGE INTO UDBD11.SBF110 BF
	cQry +=	" USING (
	cQry +=	" SELECT *
	cQry +=	" FROM (
	cQry +=	" SELECT BF.R_E_C_N_O_ RECSBF, BF_FILIAL, BF_PRODUTO, BF_LOCAL, BF_LOCALIZ, BF_EMPENHO, SUM(DC_QUANT) QTDDC
	cQry +=	" FROM UDBD11.SBF110 BF
	cQry +=	" LEFT JOIN UDBD11.SDC110 DC
	cQry +=	" ON DC_FILIAL=BF_FILIAL AND DC_PRODUTO=BF_PRODUTO AND DC_LOCAL=BF_LOCAL AND DC_LOCALIZ=BF_LOCALIZ
	cQry +=	" WHERE BF.D_E_L_E_T_=' ' AND DC.D_E_L_E_T_=' '
	cQry +=	" AND BF_FILIAL='01'
	cQry +=	" GROUP BY BF.R_E_C_N_O_, BF_FILIAL, BF_PRODUTO, BF_LOCAL, BF_LOCALIZ, BF_EMPENHO
	cQry +=	" ) XXX
	cQry +=	" WHERE BF_EMPENHO<>QTDDC
	cQry +=	" ) YYY
	cQry +=	" ON (YYY.RECSBF=BF.R_E_C_N_O_)
	cQry +=	" WHEN MATCHED THEN UPDATE SET
	cQry +=	" BF.BF_EMPENHO=YYY.QTDDC

	TcSQLExec(cQry)

	cQry :=	" MERGE INTO SBF030 BF
	cQry +=	" USING (
	cQry +=	" SELECT *
	cQry +=	" FROM (
	cQry +=	" SELECT BF.R_E_C_N_O_ RECSBF, BF_FILIAL, BF_PRODUTO, BF_LOCAL, BF_LOCALIZ, BF_EMPENHO, SUM(DC_QUANT) QTDDC
	cQry +=	" FROM SBF030 BF
	cQry +=	" LEFT JOIN SDC030 DC
	cQry +=	" ON DC_FILIAL=BF_FILIAL AND DC_PRODUTO=BF_PRODUTO AND DC_LOCAL=BF_LOCAL AND DC_LOCALIZ=BF_LOCALIZ
	cQry +=	" WHERE BF.D_E_L_E_T_=' ' AND DC.D_E_L_E_T_=' '
	cQry +=	" AND BF_FILIAL='01'
	cQry +=	" GROUP BY BF.R_E_C_N_O_, BF_FILIAL, BF_PRODUTO, BF_LOCAL, BF_LOCALIZ, BF_EMPENHO
	cQry +=	" ) XXX
	cQry +=	" WHERE BF_EMPENHO<>QTDDC
	cQry +=	" ) YYY
	cQry +=	" ON (YYY.RECSBF=BF.R_E_C_N_O_)
	cQry +=	" WHEN MATCHED THEN UPDATE SET
	cQry +=	" BF.BF_EMPENHO=YYY.QTDDC

	TcSQLExec(cQry)

	cQry :=	" MERGE INTO SBF010 BF
	cQry +=	" USING (
	cQry +=	" SELECT *
	cQry +=	" FROM (
	cQry +=	" SELECT BF.R_E_C_N_O_ RECSBF, BF_FILIAL, BF_PRODUTO, BF_LOCAL, BF_LOCALIZ, BF_EMPENHO, SUM(DC_QUANT) QTDDC
	cQry +=	" FROM SBF010 BF
	cQry +=	" LEFT JOIN SDC010 DC
	cQry +=	" ON DC_FILIAL=BF_FILIAL AND DC_PRODUTO=BF_PRODUTO AND DC_LOCAL=BF_LOCAL AND DC_LOCALIZ=BF_LOCALIZ
	cQry +=	" WHERE BF.D_E_L_E_T_=' ' AND DC.D_E_L_E_T_=' '
	cQry +=	" AND BF_FILIAL='05'
	cQry +=	" GROUP BY BF.R_E_C_N_O_, BF_FILIAL, BF_PRODUTO, BF_LOCAL, BF_LOCALIZ, BF_EMPENHO
	cQry +=	" ) XXX
	cQry +=	" WHERE BF_EMPENHO<>QTDDC
	cQry +=	" ) YYY
	cQry +=	" ON (YYY.RECSBF=BF.R_E_C_N_O_)
	cQry +=	" WHEN MATCHED THEN UPDATE SET
	cQry +=	" BF.BF_EMPENHO=YYY.QTDDC

	TcSQLExec(cQry)


	// Ajusta Saldo de Pedido na Argentina
	cQry := " MERGE INTO UDBP12ARG.SB2070 B2 "
	cQry += " USING ( "
	cQry += " SELECT B1_COD, B2_QPEDVEN, B2.R_E_C_N_O_ RECSB2, NVL(SUM(C6_QTDVEN-C6_QTDENT),0) QTDPED "
	cQry += " FROM UDBP12ARG.SB1070 B1 "
	cQry += " LEFT JOIN UDBP12ARG.SC6070 C6 "
	cQry += " ON C6_PRODUTO=B1_COD AND C6_BLQ=' ' AND C6_QTDVEN-C6_QTDENT>0 AND C6.D_E_L_E_T_=' ' "
	cQry += " LEFT JOIN UDBP12ARG.SB2070 B2 "
	cQry += " ON B2_FILIAL='01' AND B2_COD=B1_COD AND B2_LOCAL=B1_LOCPAD AND B2.D_E_L_E_T_=' ' "
	cQry += " WHERE B1.D_E_L_E_T_=' ' "
	cQry += " GROUP BY B1_COD, B2_QPEDVEN, B2.R_E_C_N_O_ "
	cQry += " ) XXX "
	cQry += " ON (XXX.RECSB2=B2.R_E_C_N_O_) "
	cQry += " WHEN MATCHED THEN UPDATE SET "
	cQry += " B2.B2_QPEDVEN=XXX.QTDPED "

	TcSQLExec(cQry)

 	cQry := " MERGE INTO SB2010 XSB2
 	cQry += " USING ( 
 	cQry += " SELECT * FROM(
 	cQry += " SELECT B2.R_E_C_N_O_ B2REC, DA_FILIAL,DA_PRODUTO,DA_LOCAL,B2.B2_Qaclass, SUM(DA_SALDO) DA_SALDO 
 	cQry += " FROM SDA010 DA
 	cQry += "    LEFT JOIN SB2010 B2
 	cQry += "        ON B2.B2_FILIAL = DA.DA_FILIAL
 	cQry += "            AND B2.B2_COD = DA.DA_PRODUTO
 	cQry += "            AND B2.B2_LOCAL = DA.DA_LOCAL
 	cQry += "            AND B2.D_E_L_E_T_ = ' '
 	cQry += " WHERE DA_FILIAL = '02'
 	cQry += " AND DA_SALDO > 0
 	cQry += " AND DA_LOCAL = '03'
 	cQry += " AND DA.D_E_L_E_T_ = ' '
 	cQry += " GROUP BY B2.R_E_C_N_O_,DA_FILIAL,DA_PRODUTO,DA_LOCAL,B2.B2_Qaclass
 	cQry += " ) XX1
 	cQry += " WHERE Xx1.B2_Qaclass <> Xx1.Da_Saldo) XX2
 	cQry += " ON (XSB2.R_E_C_N_O_= XX2.B2REC)
 	cQry += " WHEN MATCHED THEN UPDATE 
 	cQry += " SET XSB2.B2_QACLASS = XX2.DA_SALDO

	TcSQLExec(cQry)

	cQry := " MERGE INTO UDBD11.SB2110 XSB2
	cQry += " USING ( 
 	cQry += "	SELECT * FROM(
 	cQry += "	SELECT B2.R_E_C_N_O_ B2REC, DA_FILIAL,DA_PRODUTO,DA_LOCAL,B2.B2_Qaclass, SUM(DA_SALDO) DA_SALDO 
 	cQry += "	FROM UDBD11.SDA110 DA
 	cQry += "	   LEFT JOIN UDBD11.SB2110 B2
 	cQry += "	       ON B2.B2_FILIAL = DA.DA_FILIAL
 	cQry += "	           AND B2.B2_COD = DA.DA_PRODUTO
 	cQry += "	           AND B2.B2_LOCAL = DA.DA_LOCAL
 	cQry += "	           AND B2.D_E_L_E_T_ = ' '
 	cQry += "	WHERE DA_FILIAL = '01'
 	cQry += "	AND DA_SALDO > 0
 	cQry += "	AND DA_LOCAL = '03'
 	cQry += "	AND DA.D_E_L_E_T_ = ' '
 	cQry += "	GROUP BY B2.R_E_C_N_O_,DA_FILIAL,DA_PRODUTO,DA_LOCAL,B2.B2_Qaclass
 	cQry += "	) XX1
 	cQry += "	WHERE Xx1.B2_Qaclass <> Xx1.Da_Saldo) XX2
 	cQry += "	ON (XSB2.R_E_C_N_O_= XX2.B2REC)
 	cQry += "	WHEN MATCHED THEN UPDATE 
 	cQry += "	SET XSB2.B2_QACLASS = XX2.DA_SALDO

	 TcSQLExec(cQry)
	//>>Ticket 20210610009789 - Everson Santana 15.06.2021

	 cQry := " MERGE INTO UDBP12ARG.SB2070 B2 
	 cQry += " USING ( 
    cQry += " SELECT * FROM (
	 cQry += " SELECT B1_COD, B2_SALPEDI, B2.R_E_C_N_O_ RECSB2, NVL(SUM(C7_QUANT-C7_QUJE),0) QTDPED 
	 cQry += " FROM UDBP12ARG.SB1070 B1 
	 cQry += " LEFT JOIN UDBP12ARG.SC7070 C7 
	 cQry += " ON C7_PRODUTO=B1_COD AND C7_QUANT-C7_QUJE>0 AND C7.D_E_L_E_T_=' ' 
	 cQry += " LEFT JOIN UDBP12ARG.SB2070 B2 
	 cQry += " ON B2_FILIAL='01' AND B2_COD=B1_COD AND B2_LOCAL=B1_LOCPAD AND B2.D_E_L_E_T_=' ' 
	 cQry += " WHERE B1.D_E_L_E_T_=' ' 
	 cQry += " GROUP BY B1_COD, B2_SALPEDI, B2.R_E_C_N_O_ ) XX1
     cQry += " WHERE XX1.B2_SALPEDI <> XX1.Qtdped
	 cQry += " ) XXX 
	 cQry += " ON (XXX.RECSB2=B2.R_E_C_N_O_) 
	 cQry += " WHEN MATCHED THEN UPDATE SET 
	 cQry += " B2.B2_SALPEDI=XXX.QTDPED

	TcSQLExec(cQry)

	//<<Ticket 20210610009789

Return()

